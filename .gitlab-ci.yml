runner-eks-test:
  stage: test
  image: 
    name: amazon/aws-cli:latest
    entrypoint: [""]
  script:
    # 키가 제대로 들어왔는지 길이 검사 (20자가 아니면 실패 처리)
    - |
      if [ ${#AWS_ACCESS_KEY_ID} -ne 20 ]; then
        echo "Error: AWS_ACCESS_KEY_ID is ${#AWS_ACCESS_KEY_ID} characters long. It must be 20."
        exit 1
      fi

    # 별도의 configure 없이 환경변수로 직접 주입 (이게 더 확실함)
    - export AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
    - export AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
    - export AWS_DEFAULT_REGION=${AWS_REGION}

    - curl -LO "https://dl.k8s.io/release/v1.31.0/bin/linux/amd64/kubectl"
    - chmod +x ./kubectl
    - mv ./kubectl /usr/local/bin/kubectl

    - aws eks update-kubeconfig --region $AWS_DEFAULT_REGION --name fromprom-cluster
    - kubectl get nodes